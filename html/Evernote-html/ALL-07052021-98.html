<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 98</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:10px;font-family:DejaVuSerif;color:#000000;}
	.ft01{font-size:15px;font-family:DejaVuSerif;color:#000000;}
	.ft02{font-size:10px;font-family:DejaVuSerif;color:#000000;}
	.ft03{font-size:10px;font-family:DejaVuSansMono;color:#000000;}
	.ft04{font-size:10px;line-height:11px;font-family:DejaVuSerif;color:#000000;}
	.ft05{font-size:10px;line-height:12px;font-family:DejaVuSerif;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page98-div" style="position:relative;width:892px;height:1263px;">
<img width="892" height="1263" src="ALL-07052021098.png" alt="background image"/>
<p style="position:absolute;top:54px;left:84px;white-space:nowrap" class="ft04">The&#160;/tmp/.X11-unix/X0&#160;special&#160;file&#160;needs&#160;to&#160;be&#160;available&#160;in&#160;an&#160;image&#160;for&#160;X&#160;applications&#160;to&#160;work&#160;in&#160;the&#160;chrooted&#160;environment&#160;on&#160;(say)&#160;a&#160;desktop&#160;PC,<br/>either&#160;by&#160;bind-mounting&#160;all&#160;of&#160;/tmp&#160;as&#160;above,&#160;or&#160;bind-mounting&#160;just&#160;that&#160;particular&#160;special&#160;file/socket.</p>
<p style="position:absolute;top:88px;left:84px;white-space:nowrap" class="ft00">/selinux&#160;has&#160;been&#160;included&#160;above,&#160;but&#160;in&#160;fact&#160;selinux&#160;needs&#160;to&#160;be&#160;tailored,&#160;or&#160;off,&#160;in&#160;order&#160;for&#160;a&#160;chrooted&#160;bash&#160;to&#160;work,&#160;as&#160;of&#160;SL5.2.&#160;(...).</p>
<p style="position:absolute;top:110px;left:84px;white-space:nowrap" class="ft04">For&#160;Torque/PBS&#160;worker&#160;nodes,&#160;nodefile&#160;and&#160;jobfile&#160;directories&#160;/var/spool/torque/aux&#160;and&#160;/var/spool/torque/mom_priv/jobs&#160;(or&#160;whatever&#160;the&#160;naming<br/>convention&#160;is&#160;on&#160;your&#160;system)&#160;need&#160;to&#160;be&#160;bind-mounted&#160;to&#160;the&#160;directories&#160;of&#160;the&#160;same&#160;name&#160;in&#160;the&#160;image(s).&#160;You&#160;can&#160;achieve&#160;that&#160;most&#160;easily&#160;by&#160;bind-<br/>mounting&#160;just&#160;/var/spool/torque,&#160;and&#160;that&#160;works&#160;fine.</p>
<p style="position:absolute;top:159px;left:59px;white-space:nowrap" class="ft01"><b>Other&#160;considerations</b></p>
<p style="position:absolute;top:189px;left:59px;white-space:nowrap" class="ft00">There&#160;may&#160;be&#160;lots&#160;of&#160;other&#160;things&#160;that&#160;need&#160;to&#160;be&#160;considered;&#160;some&#160;of&#160;them&#160;are:</p>
<p style="position:absolute;top:212px;left:84px;white-space:nowrap" class="ft05"><b>/etc/resolv.conf</b>&#160;needs&#160;to&#160;be&#160;consistent&#160;between&#160;native&#160;and&#160;chrooted&#160;images&#160;(so&#160;do&#160;a&#160;copy&#160;at&#160;boot&#160;time),&#160;for&#160;any&#160;DNS&#160;lookups&#160;to&#160;work.<br/><b>/etc/nsswitch.conf</b>&#160;also&#160;needs&#160;to&#160;be&#160;consistent,&#160;for&#160;network-based&#160;authentication&#160;and&#160;look-ups.<br/><b>/etc/hosts</b>&#160;needs&#160;to&#160;be&#160;consistent,&#160;if&#160;populated&#160;in&#160;the&#160;base&#160;system.<br/><b>/etc/passwd</b>&#160;and&#160;<b>/etc/group</b>&#160;files&#160;should&#160;be&#160;consistent,&#160;unless&#160;the&#160;authentication&#160;method&#160;is&#160;network-based:&#160;LDAP&#160;for&#160;example.<br/><b>/etc/pam.d/system-auth</b>,&#160;if&#160;customised&#160;for&#160;longer&#160;/&#160;stronger&#160;passwords,&#160;also&#160;needs&#160;to&#160;customised&#160;in&#160;the&#160;images,&#160;for&#160;consistency&#160;of&#160;enforcement.<br/><b>/etc/mail/submit.cf</b>&#160;needs&#160;to&#160;be&#160;consistent&#160;if&#160;you&#160;want&#160;mail&#160;commands&#160;to&#160;work.&#160;In&#160;addition,&#160;for&#160;the&#160;rare&#160;cases&#160;where&#160;an&#160;email&#160;transaction&#160;initially<br/>fails&#160;and&#160;gets&#160;deferred,&#160;you&#160;might&#160;consider&#160;running&#160;a&#160;sendmail&#160;client&#160;daemon&#160;per&#160;image,&#160;or&#160;do&#160;a&#160;bind-mount&#160;of&#160;/var/spool/clientmqueue&#160;directories,&#160;or<br/>have&#160;a&#160;cron&#160;task&#160;to&#160;move&#160;files&#160;in&#160;those&#160;directories&#160;into&#160;the&#160;base&#160;system&#160;(which&#160;is&#160;what&#160;I&#160;do).&#160;Watch&#160;out&#160;for&#160;different&#160;group-ids&#160;for&#160;smmsp&#160;in&#160;different<br/>systems,&#160;though,&#160;which&#160;if&#160;true&#160;requires&#160;your&#160;cron&#160;task&#160;to&#160;chgrp&#160;the&#160;moved&#160;files.&#160;(Fedora&#160;12&#160;had&#160;that&#160;issue;&#160;Fedora&#160;14/15&#160;reverts&#160;to&#160;uid:gid&#160;51:51&#160;like<br/>RHEL).<br/><b>/etc/mtab</b>,&#160;where&#160;this&#160;is&#160;a&#160;regular&#160;file&#160;(rather&#160;than&#160;a&#160;sym-link&#160;to&#160;/proc/mounts),&#160;can&#160;be&#160;made&#160;consistent,&#160;eg&#160;stream-edited,&#160;into&#160;the&#160;images,&#160;so&#160;that&#160;a&#160;</p>
<p style="position:absolute;top:335px;left:846px;white-space:nowrap" class="ft00">df</p>
<p style="position:absolute;top:347px;left:84px;white-space:nowrap" class="ft05">command&#160;shows&#160;available&#160;file-systems.<br/><b>/var/lib/dbus/machine-id</b>&#160;can&#160;be&#160;copied&#160;into&#160;the&#160;images,&#160;so&#160;that&#160;certain&#160;facilities&#160;work&#160;(more&#160;details?).<br/><b>/etc/cups/client.conf</b>&#160;can&#160;be&#160;made&#160;consistent&#160;in&#160;the&#160;images,&#160;to&#160;give&#160;the&#160;same&#160;CUPS&#160;client&#160;set-up.</p>
<p style="position:absolute;top:394px;left:59px;white-space:nowrap" class="ft00">By&#160;</p>
<p style="position:absolute;top:394px;left:75px;white-space:nowrap" class="ft00">consistent,&#160;I&#160;don't&#160;necessary&#160;mean&#160;identical,&#160;but&#160;giving&#160;the&#160;same&#160;effect.</p>
<p style="position:absolute;top:416px;left:59px;white-space:nowrap" class="ft04">In&#160;a&#160;system&#160;where&#160;one&#160;is&#160;trying&#160;to&#160;achieve&#160;isolation&#160;between&#160;the&#160;different&#160;virtual&#160;systems&#160;(we're&#160;not!)&#160;then&#160;of&#160;course&#160;the&#160;above&#160;remarks&#160;don't&#160;necessarily<br/>apply.</p>
<p style="position:absolute;top:453px;left:59px;white-space:nowrap" class="ft01"><b>Security</b></p>
<p style="position:absolute;top:484px;left:59px;white-space:nowrap" class="ft04">The&#160;system&#160;administrators&#160;need&#160;to&#160;keep&#160;sub-systems&#160;up-to-date&#160;as&#160;far&#160;as&#160;non-kernel&#160;security&#160;fixes&#160;are&#160;concerned,&#160;just&#160;as&#160;they&#160;would&#160;do&#160;if&#160;those&#160;systems<br/>were&#160;stand-alone,&#160;because&#160;(for&#160;example)&#160;a&#160;setuid&#160;program&#160;which&#160;is&#160;discovered&#160;to&#160;have&#160;an&#160;exploit&#160;which&#160;gives&#160;uncontrolled&#160;root&#160;access&#160;is&#160;a&#160;security&#160;hazard,<br/>whether&#160;it&#160;be&#160;in&#160;a&#160;native&#160;or&#160;chrooted&#160;environment.&#160;So,&#160;for&#160;example,&#160;a&#160;glibc&#160;vulnerable&#160;to&#160;CVE-2010-3847&#160;would&#160;be&#160;exploitable.&#160;It&#160;would&#160;be&#160;incorrect&#160;to<br/>assume&#160;that&#160;the&#160;chrooted&#160;environment&#160;provides&#160;some&#160;protection&#160;from&#160;such&#160;hazards&#160;because,&#160;as&#160;is&#160;well&#160;known,&#160;it's&#160;not&#160;hard&#160;for&#160;a&#160;root&#160;user&#160;to&#160;break&#160;out&#160;into<br/>the&#160;native&#160;environment,&#160;and&#160;in&#160;any&#160;case&#160;a&#160;malicious&#160;root&#160;user&#160;can&#160;do&#160;damage&#160;enough&#160;without&#160;breaking&#160;out.&#160;On&#160;the&#160;other&#160;hand,&#160;kernel-exploit&#160;vulnerabilities<br/>of&#160;the&#160;sub-systems&#160;are&#160;not&#160;of&#160;concern,&#160;as&#160;we&#160;only&#160;use&#160;the&#160;native&#160;system's&#160;kernel,&#160;and&#160;vulnerabilities&#160;in&#160;daemons&#160;(like&#160;sshd&#160;or&#160;ntpd)&#160;are&#160;unlikely&#160;to&#160;have&#160;an<br/>impact&#160;since&#160;there&#160;is&#160;usually&#160;no&#160;reason&#160;to&#160;run&#160;non-native&#160;versions&#160;of&#160;those&#160;daemons.&#160;With&#160;use&#160;of&#160;kernel&#160;</p>
<p style="position:absolute;top:555px;left:591px;white-space:nowrap" class="ft00">capabilities,&#160;particularly&#160;a&#160;capability&#160;bounding&#160;set</p>
<p style="position:absolute;top:567px;left:59px;white-space:nowrap" class="ft00">in&#160;kernel&#160;versions&#160;2.6.25&#160;onwards,&#160;it&#160;should&#160;be&#160;possible&#160;to&#160;restrict&#160;what&#160;privileges&#160;a&#160;user&#160;can&#160;acquire&#160;in&#160;their&#160;sessions,&#160;anyway.</p>
<p style="position:absolute;top:592px;left:59px;white-space:nowrap" class="ft01"><b>Examples&#160;of&#160;using&#160;SL4&#160;in&#160;a&#160;login&#160;session</b></p>
<p style="position:absolute;top:622px;left:59px;white-space:nowrap" class="ft04">For&#160;a&#160;local&#160;user&#160;desktop,&#160;users&#160;are&#160;provided&#160;with&#160;icons&#160;to&#160;invoke&#160;terminal&#160;sessions&#160;in&#160;the&#160;various&#160;environments:&#160;here's&#160;an&#160;example&#160;showing&#160;a&#160;Fedora&#160;12<br/>KDE&#160;panel&#160;with&#160;terminal&#160;icons&#160;for&#160;Fedora&#160;12,&#160;SL5,&#160;SL4,&#160;plus&#160;various&#160;ssh&#160;calls&#160;to&#160;remote&#160;machines,&#160;with&#160;further&#160;icons&#160;for&#160;the&#160;latest&#160;versions&#160;of&#160;Firefox,<br/>ICAClient,&#160;EVO,&#160;Skype,&#160;and&#160;Google&#160;Earth&#160;running&#160;under&#160;Fedora&#160;12:</p>
<p style="position:absolute;top:695px;left:59px;white-space:nowrap" class="ft00">The&#160;following&#160;comments&#160;are&#160;for&#160;non-local&#160;sessions,&#160;and&#160;are&#160;a&#160;bit&#160;historical.</p>
<p style="position:absolute;top:718px;left:59px;white-space:nowrap" class="ft00">For&#160;a&#160;login&#160;session&#160;in&#160;SL4,&#160;after&#160;logging&#160;in&#160;type&#160;in:&#160;<b>/bin4/bash</b>.&#160;To&#160;drop&#160;back&#160;to&#160;the&#160;native&#160;environment,&#160;type&#160;<b>exit</b>.</p>
<p style="position:absolute;top:740px;left:59px;white-space:nowrap" class="ft04">To&#160;run&#160;just&#160;one&#160;particular&#160;script&#160;in&#160;SL4,&#160;you&#160;can&#160;do&#160;this&#160;without&#160;going&#160;into&#160;an&#160;SL4&#160;login&#160;session.&#160;Let's&#160;say&#160;the&#160;first&#160;line&#160;of&#160;the&#160;script&#160;is&#160;<b>#!/bin/sh</b>.&#160;You&#160;can<br/>either&#160;enter:</p>
<p style="position:absolute;top:774px;left:59px;white-space:nowrap" class="ft03">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/bin4/sh&#160;myscript&#160;&#160;&#160;&#160;</p>
<p style="position:absolute;top:774px;left:241px;white-space:nowrap" class="ft03">any&#160;args</p>
<p style="position:absolute;top:797px;left:59px;white-space:nowrap" class="ft00">or&#160;put&#160;<b>#!/bin4/sh</b>&#160;as&#160;the&#160;first&#160;line&#160;of&#160;that&#160;script,&#160;and&#160;then&#160;run&#160;it&#160;simply&#160;by:</p>
<p style="position:absolute;top:819px;left:59px;white-space:nowrap" class="ft03">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;myscript&#160;&#160;&#160;&#160;</p>
<p style="position:absolute;top:818px;left:186px;white-space:nowrap" class="ft03">any&#160;args</p>
<p style="position:absolute;top:841px;left:59px;white-space:nowrap" class="ft00">The&#160;following&#160;are&#160;available&#160;to&#160;our&#160;users&#160;at&#160;the&#160;time&#160;of&#160;writing:&#160;/bin4/sh,&#160;/bin4/bash,&#160;/bin4/ksh,&#160;/bin4/zsh,&#160;/bin4/csh,&#160;/bin4/tcsh.</p>
<p style="position:absolute;top:863px;left:59px;white-space:nowrap" class="ft04">If&#160;you&#160;choose&#160;to&#160;do&#160;this&#160;/bin4/&#160;script&#160;modification,&#160;note&#160;that&#160;inside&#160;the&#160;SL4&#160;environment,&#160;the&#160;/bin4/&#160;binaries&#160;also&#160;exist,&#160;but&#160;are&#160;simply&#160;soft-links&#160;to&#160;the&#160;/bin/<br/>binaries,&#160;so&#160;behave&#160;in&#160;a&#160;consistent&#160;way,&#160;and&#160;so&#160;there&#160;is&#160;no&#160;need&#160;to&#160;keep&#160;a&#160;second&#160;copy&#160;of&#160;the&#160;script&#160;which&#160;has&#160;the&#160;conventional&#160;invocation&#160;as&#160;its&#160;first&#160;line.</p>
<p style="position:absolute;top:897px;left:59px;white-space:nowrap" class="ft04">Scripts&#160;which&#160;are&#160;invoked&#160;by&#160;other&#160;scripts&#160;already&#160;in&#160;an&#160;SL4&#160;environment&#160;are&#160;run&#160;in&#160;that&#160;same&#160;SL4&#160;environmnent.&#160;That&#160;applies&#160;in&#160;an&#160;interactive&#160;session<br/>and&#160;in&#160;a&#160;job.&#160;So&#160;there&#160;is&#160;no&#160;need&#160;to&#160;invoke&#160;those&#160;in&#160;a&#160;special&#160;way&#160;or&#160;go&#160;to&#160;the&#160;trouble&#160;of&#160;modifying&#160;them.</p>
<p style="position:absolute;top:933px;left:59px;white-space:nowrap" class="ft01"><b>Using&#160;SL4&#160;in&#160;a&#160;submitted&#160;job</b></p>
<p style="position:absolute;top:964px;left:59px;white-space:nowrap" class="ft04">Our&#160;users&#160;are&#160;now&#160;provided&#160;with&#160;qsub4&#160;and&#160;qsub5&#160;commands,&#160;which&#160;make&#160;use&#160;of&#160;the&#160;-D&#160;option&#160;of&#160;qsub,&#160;so&#160;the&#160;following&#160;old&#160;notes&#160;are&#160;just&#160;included&#160;for<br/>interest.</p>
<p style="position:absolute;top:999px;left:59px;white-space:nowrap" class="ft05">Users&#160;can&#160;submit&#160;a&#160;job&#160;to&#160;run&#160;in&#160;SL4&#160;from&#160;within&#160;a&#160;SL4&#160;or&#160;SL5&#160;session.&#160;The&#160;method&#160;is&#160;exactly&#160;the&#160;same:&#160;jobs&#160;<b>do&#160;NOT</b>&#160;inherit&#160;the&#160;operating&#160;system&#160;of&#160;the<br/>submitting&#160;system&#160;(that&#160;is,&#160;the&#160;system&#160;doing&#160;the&#160;<b>qsub</b>).</p>
<p style="position:absolute;top:1034px;left:59px;white-space:nowrap" class="ft04">To&#160;run&#160;a&#160;job&#160;totally&#160;within&#160;SL4,&#160;submit&#160;it&#160;with&#160;the&#160;qsub&#160;option&#160;<b>-S&#160;/bin4/bash</b>.&#160;That&#160;is,&#160;either&#160;use&#160;that&#160;option&#160;on&#160;the&#160;qsub&#160;command&#160;line,&#160;or&#160;put&#160;this&#160;in&#160;the<br/>submitted&#160;job&#160;script:</p>
<p style="position:absolute;top:1068px;left:59px;white-space:nowrap" class="ft03">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#PBS&#160;-S&#160;/bin4/bash</p>
<p style="position:absolute;top:1090px;left:59px;white-space:nowrap" class="ft04">Alternatively,&#160;you&#160;can&#160;choose&#160;that&#160;the&#160;script&#160;only&#160;(and&#160;not&#160;the&#160;initialisation&#160;of&#160;the&#160;job)&#160;is&#160;run&#160;under&#160;SL4,&#160;using&#160;one&#160;of&#160;the&#160;techniques&#160;described&#160;above&#160;for<br/>login&#160;sessions:&#160;using&#160;the&#160;/bin4/&#160;binaries&#160;either&#160;to&#160;invoke&#160;a&#160;script,&#160;or&#160;as&#160;the&#160;first&#160;line&#160;of&#160;a&#160;script,&#160;possibly&#160;the&#160;job-script.</p>
<p style="position:absolute;top:1124px;left:59px;white-space:nowrap" class="ft04">An&#160;alternative&#160;is&#160;to&#160;use&#160;the&#160;<b>-D</b>&#160;option&#160;of&#160;the&#160;qsub&#160;command.&#160;Torque&#160;has&#160;its&#160;own&#160;chroot&#160;facility&#160;built&#160;in.&#160;The&#160;<b>-D</b>&#160;option&#160;should&#160;specify&#160;the&#160;root&#160;directory&#160;of&#160;the<br/>alternative&#160;system,&#160;eg:</p>
<p style="position:absolute;top:1158px;left:59px;white-space:nowrap" class="ft03">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;qsub&#160;-D&#160;/sysroot/SL48&#160;myjob.sh</p>
</div>
</body>
</html>
