<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 99</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:15px;font-family:DejaVuSerif;color:#000000;}
	.ft01{font-size:10px;font-family:DejaVuSerif;color:#000000;}
	.ft02{font-size:10px;font-family:DejaVuSansMono;color:#000000;}
	.ft03{font-size:10px;font-family:DejaVuSerif;color:#000000;}
	.ft04{font-size:10px;font-family:DejaVuSerif;color:#0000ee;}
	.ft05{font-size:10px;line-height:11px;font-family:DejaVuSerif;color:#000000;}
	.ft06{font-size:10px;line-height:11px;font-family:DejaVuSansMono;color:#000000;}
	.ft07{font-size:10px;line-height:12px;font-family:DejaVuSerif;color:#000000;}
	.ft08{font-size:10px;line-height:11px;font-family:DejaVuSerif;color:#000000;}
	.ft09{font-size:10px;line-height:11px;font-family:DejaVuSerif;color:#0000ee;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page99-div" style="position:relative;width:892px;height:1263px;">
<img width="892" height="1263" src="ALL-07052021099.png" alt="background image"/>
<p style="position:absolute;top:54px;left:59px;white-space:nowrap" class="ft00"><b>Why&#160;implement&#160;it&#160;that&#160;way?</b></p>
<p style="position:absolute;top:85px;left:59px;white-space:nowrap" class="ft05">Why&#160;implement&#160;SL4&#160;or&#160;SL5&#160;as&#160;an&#160;image&#160;inside&#160;another&#160;system,&#160;when&#160;you&#160;could&#160;simply&#160;have&#160;a&#160;different&#160;system&#160;image&#160;for&#160;each&#160;node?&#160;The&#160;cluster&#160;we&#160;wanted<br/>this&#160;facility&#160;for&#160;originally&#160;uses&#160;the&#160;ClusterVision&#160;OS&#160;infrastructure,&#160;which&#160;easily&#160;allows&#160;for&#160;different&#160;workers&#160;having&#160;different&#160;images.</p>
<p style="position:absolute;top:119px;left:59px;white-space:nowrap" class="ft01">Well,&#160;having&#160;worker&#160;nodes&#160;which&#160;run&#160;SL4&#160;natively&#160;was&#160;certainly&#160;an&#160;option,&#160;and&#160;is&#160;still&#160;an&#160;option&#160;for&#160;us.</p>
<p style="position:absolute;top:141px;left:59px;white-space:nowrap" class="ft05">One&#160;thing&#160;in&#160;favour&#160;of&#160;the&#160;chosen&#160;method&#160;is&#160;that&#160;we&#160;don't&#160;need&#160;to&#160;consider&#160;the&#160;numbers&#160;game,&#160;of&#160;how&#160;many&#160;nodes&#160;of&#160;each&#160;system.&#160;A&#160;worker&#160;node&#160;can&#160;run&#160;a<br/>mixture&#160;of&#160;processes&#160;from&#160;different&#160;distros,&#160;rather&#160;than&#160;being&#160;dedicated&#160;to&#160;one&#160;or&#160;another.&#160;Another&#160;benefit&#160;is&#160;running&#160;with&#160;a&#160;single&#160;kernel&#160;version,&#160;which<br/>the&#160;vendor&#160;believed&#160;would&#160;improve&#160;GPFS&#160;stability.</p>
<p style="position:absolute;top:187px;left:59px;white-space:nowrap" class="ft05">Another&#160;scenario&#160;could&#160;be&#160;to&#160;run&#160;the&#160;different&#160;systems&#160;virtually,&#160;using&#160;Xen,&#160;KVM,&#160;or&#160;another&#160;virtualisation&#160;technique.&#160;However,&#160;for&#160;our&#160;uni&#160;cluster,&#160;that<br/>would&#160;involve&#160;GPFS&#160;running&#160;on&#160;different&#160;kernel&#160;versions,&#160;with&#160;two&#160;or&#160;more&#160;instances&#160;per&#160;worker&#160;node,&#160;and&#160;the&#160;cluster&#160;vendor&#160;was&#160;not&#160;in&#160;favour&#160;of&#160;that<br/>approach,&#160;having&#160;already&#160;declared&#160;a&#160;preference&#160;for&#160;having&#160;one&#160;kernel&#160;version&#160;for&#160;GPFS&#160;throughout&#160;the&#160;cluster.&#160;There&#160;is&#160;also&#160;the&#160;question&#160;of&#160;the<br/>comparative&#160;efficiency&#160;or&#160;inefficiency&#160;of&#160;having&#160;fully-virtualized&#160;environments&#160;compared&#160;with&#160;our&#160;environment:&#160;the&#160;scheduling&#160;between&#160;different&#160;VMs,<br/>additional&#160;kernels&#160;in&#160;memory,&#160;multiple&#160;NFS&#160;mounts&#160;of&#160;each&#160;filesystem&#160;per&#160;PC,&#160;multiple&#160;virtual&#160;network&#160;interfaces,&#160;sharing&#160;of&#160;local-disk&#160;filesystems&#160;like<br/>/tmp,&#160;and&#160;so&#160;on.</p>
<p style="position:absolute;top:269px;left:59px;white-space:nowrap" class="ft05">Also&#160;this&#160;method&#160;adapts&#160;very&#160;easily&#160;to&#160;use&#160;on&#160;an&#160;individual&#160;person's&#160;desktop&#160;PC,&#160;which&#160;allows&#160;the&#160;system&#160;administrator&#160;to&#160;provide&#160;the&#160;latest&#160;flavour&#160;of<br/>Linux&#160;operating&#160;system&#160;and&#160;so&#160;provide&#160;the&#160;latest&#160;snazzy&#160;applications,&#160;while&#160;preserving&#160;the&#160;backward&#160;compatibility&#160;the&#160;user&#160;often&#160;requires&#160;to&#160;run&#160;their&#160;own<br/>analysis&#160;applications.</p>
<p style="position:absolute;top:317px;left:59px;white-space:nowrap" class="ft00"><b>Knowing&#160;what&#160;system&#160;you're&#160;on</b></p>
<p style="position:absolute;top:348px;left:59px;white-space:nowrap" class="ft01">So&#160;you&#160;always&#160;know&#160;which&#160;release&#160;you&#160;are&#160;on,&#160;you&#160;can&#160;add&#160;the&#160;following&#160;to&#160;your&#160;$HOME/.bashrc:</p>
<p style="position:absolute;top:370px;left:59px;white-space:nowrap" class="ft06">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;release=$(lsb_release&#160;-r&#160;-s)<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;echo&#160;You&#160;are&#160;running&#160;on&#160;release&#160;$release&#160;&gt;&amp;2<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PS1=$release-$PS1</p>
<p style="position:absolute;top:416px;left:59px;white-space:nowrap" class="ft05">(The&#160;redirection&#160;on&#160;the&#160;echo&#160;is&#160;important,&#160;as&#160;always&#160;inside&#160;a&#160;.bashrc,&#160;if&#160;you&#160;want&#160;scp&#160;and&#160;sftp&#160;to&#160;continue&#160;to&#160;work).&#160;Remember&#160;that&#160;in&#160;a&#160;job&#160;this&#160;won't&#160;give<br/>the&#160;intended&#160;information&#160;if&#160;you&#160;have&#160;used&#160;the&#160;<b>#!/bin4/bash</b>&#160;method&#160;of&#160;invoking&#160;the&#160;job&#160;script,&#160;because&#160;in&#160;that&#160;case&#160;your&#160;login&#160;scripts&#160;will&#160;run&#160;under&#160;the<br/>native&#160;system,&#160;not&#160;the&#160;alternative&#160;system.</p>
<p style="position:absolute;top:465px;left:59px;white-space:nowrap" class="ft00"><b>Application&#160;configure/make/cmake&#160;considerations</b></p>
<p style="position:absolute;top:496px;left:59px;white-space:nowrap" class="ft01">Some&#160;program&#160;applications&#160;which&#160;are&#160;built&#160;by&#160;users&#160;may&#160;detect&#160;the&#160;current&#160;environment&#160;in&#160;a&#160;</p>
<p style="position:absolute;top:495px;left:540px;white-space:nowrap" class="ft01">configure&#160;script,&#160;like&#160;distribution&#160;and&#160;architecture,&#160;in&#160;order&#160;to</p>
<p style="position:absolute;top:508px;left:59px;white-space:nowrap" class="ft01">build&#160;with&#160;appropriate&#160;options,&#160;and&#160;this&#160;needs&#160;to&#160;work&#160;in&#160;a&#160;chrooted&#160;environment&#160;too.</p>
<p style="position:absolute;top:530px;left:59px;white-space:nowrap" class="ft05">Various&#160;methods&#160;may&#160;be&#160;used&#160;to&#160;detect&#160;the&#160;environment:&#160;the&#160;lsb_release&#160;command,&#160;the&#160;/etc/redhat-release&#160;file&#160;and&#160;similar,&#160;a&#160;gcc&#160;--version&#160;command,&#160;an<br/>rpm&#160;query&#160;for&#160;the&#160;gcc&#160;package&#160;in&#160;various&#160;architectures,&#160;the&#160;existence&#160;of&#160;a&#160;/lib64&#160;directory,&#160;and&#160;so&#160;on.&#160;All&#160;of&#160;those&#160;work&#160;well&#160;in&#160;a&#160;chrooted&#160;environment&#160;too.</p>
<p style="position:absolute;top:564px;left:59px;white-space:nowrap" class="ft07">If&#160;it's&#160;likely&#160;that&#160;a&#160;configure&#160;script&#160;might&#160;use&#160;the&#160;<b>uname&#160;-m</b>&#160;command,&#160;and&#160;if&#160;the&#160;environment&#160;is&#160;a&#160;32-bit&#160;distro&#160;running&#160;under&#160;a&#160;64-bit&#160;kernel,&#160;then&#160;on&#160;the<br/>face&#160;of&#160;it&#160;there's&#160;a&#160;difficulty.&#160;Ideally,&#160;the&#160;command&#160;which&#160;calls&#160;chroot(2)&#160;can&#160;also&#160;use&#160;syscall(2)&#160;or&#160;personality(2)&#160;directly&#160;to&#160;set&#160;the&#160;execution&#160;domain&#160;to&#160;32-<br/>bit&#160;where&#160;required,&#160;and&#160;that's&#160;what&#160;my&#160;current&#160;imageswitch&#160;command&#160;does.&#160;Or&#160;the&#160;ordinary&#160;user&#160;can&#160;invoke&#160;the&#160;configure&#160;or&#160;make&#160;script&#160;prefixed&#160;by&#160;the<br/><b>linux32</b>&#160;command,&#160;to&#160;change&#160;the&#160;apparent&#160;environment.&#160;As&#160;yet&#160;another&#160;choice,&#160;the&#160;sysadmin&#160;can&#160;rename&#160;the&#160;supplied&#160;uname&#160;command&#160;to&#160;uname.bin,&#160;and<br/>add&#160;one&#160;the&#160;following&#160;uname&#160;scripts&#160;below.</p>
<p style="position:absolute;top:635px;left:59px;white-space:nowrap" class="ft06">&#160;&#160;&#160;&#160;&#160;#!/bin/sh<br/>&#160;&#160;&#160;&#160;&#160;uname.bin&#160;&#34;${@}&#34;&#160;|&#160;sed&#160;'s/x86_64/i686/g'</p>
<p style="position:absolute;top:669px;left:59px;white-space:nowrap" class="ft01">or,&#160;making&#160;use&#160;of&#160;the&#160;setarch&#160;or&#160;i386&#160;or&#160;linux32&#160;command:</p>
<p style="position:absolute;top:691px;left:59px;white-space:nowrap" class="ft06">&#160;&#160;&#160;&#160;&#160;#!/bin/sh<br/>&#160;&#160;&#160;&#160;&#160;linux32&#160;uname.bin&#160;&#34;${@}&#34;</p>
<p style="position:absolute;top:727px;left:59px;white-space:nowrap" class="ft00"><b>Logging&#160;to&#160;syslog&#160;from&#160;within&#160;a&#160;chrooted&#160;environment</b></p>
<p style="position:absolute;top:758px;left:59px;white-space:nowrap" class="ft05">If&#160;you&#160;use&#160;the&#160;<b>logger</b>&#160;command&#160;from&#160;within&#160;the&#160;chrooted&#160;environment,&#160;or&#160;if&#160;you&#160;have&#160;daemons&#160;running&#160;within&#160;that&#160;environment&#160;which&#160;use&#160;the&#160;<b>syslog<br/></b>system&#160;call,&#160;then&#160;the&#160;logging&#160;won't&#160;actually&#160;get&#160;recorded&#160;anywhere,&#160;in&#160;a&#160;vanilla&#160;chrooted&#160;environment.&#160;This&#160;is&#160;because&#160;those&#160;facilities&#160;rely&#160;on&#160;writing&#160;to&#160;a<br/>socket&#160;<b>/dev/log</b>&#160;which&#160;is&#160;opened&#160;for&#160;input&#160;by&#160;the&#160;syslogd/rsyslogd&#160;daemon,&#160;and&#160;this&#160;daemon&#160;is&#160;by&#160;default&#160;only&#160;running&#160;in&#160;the&#160;native&#160;base&#160;system.&#160;There&#160;are<br/>several&#160;ways&#160;around&#160;this&#160;(you&#160;only&#160;need&#160;one&#160;of&#160;these!):</p>
<p style="position:absolute;top:816px;left:84px;white-space:nowrap" class="ft01">Mount&#160;the&#160;whole&#160;/dev&#160;directory&#160;over&#160;the&#160;/</p>
<p style="position:absolute;top:816px;left:297px;white-space:nowrap" class="ft01">chrooted/dev&#160;directory&#160;with&#160;the&#160;--bind&#160;option,&#160;as&#160;suggested&#160;in&#160;the&#160;earlier&#160;section&#160;on&#160;mounts.</p>
<p style="position:absolute;top:838px;left:84px;white-space:nowrap" class="ft01">Mount&#160;the&#160;specific&#160;/dev/log&#160;file&#160;over&#160;a&#160;/</p>
<p style="position:absolute;top:838px;left:284px;white-space:nowrap" class="ft01">mychroot/dev/log&#160;file;&#160;for&#160;example:</p>
<p style="position:absolute;top:860px;left:84px;white-space:nowrap" class="ft06">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;touch&#160;/mychroot/dev/log<br/>&#160;</p>
<p style="position:absolute;top:872px;left:133px;white-space:nowrap" class="ft02">&#160;mount&#160;--bind&#160;/dev/log&#160;/mychroot/dev/log</p>
<p style="position:absolute;top:894px;left:84px;white-space:nowrap" class="ft01">For&#160;rsyslogd,&#160;add&#160;a&#160;file&#160;to&#160;directory&#160;/etc/rsyslog.d/&#160;containing&#160;one&#160;or&#160;more&#160;</p>
<p style="position:absolute;top:894px;left:466px;white-space:nowrap" class="ft02">$AddUnixListenSocket&#160;/</p>
<p style="position:absolute;top:894px;left:599px;white-space:nowrap" class="ft02">mychroot/dev/log</p>
<p style="position:absolute;top:894px;left:696px;white-space:nowrap" class="ft01">&#160;lines.&#160;In&#160;other/older&#160;syslogd</p>
<p style="position:absolute;top:906px;left:84px;white-space:nowrap" class="ft01">environments,&#160;modify&#160;/etc/sysconfig/syslog&#160;and&#160;add&#160;one&#160;or&#160;more&#160;</p>
<p style="position:absolute;top:906px;left:416px;white-space:nowrap" class="ft02">-a&#160;/</p>
<p style="position:absolute;top:906px;left:440px;white-space:nowrap" class="ft02">mychroot/dev/log</p>
<p style="position:absolute;top:906px;left:537px;white-space:nowrap" class="ft01">&#160;strings&#160;to&#160;the&#160;definition&#160;of&#160;the&#160;variable&#160;SYSLOGD_OPTIONS.</p>
<p style="position:absolute;top:918px;left:84px;white-space:nowrap" class="ft01">In&#160;either&#160;case,&#160;there&#160;is&#160;no&#160;need&#160;to&#160;create&#160;the&#160;extra&#160;socket(s):&#160;the&#160;daemon&#160;will&#160;do&#160;it&#160;when&#160;it&#160;starts&#160;up.</p>
<p style="position:absolute;top:943px;left:59px;white-space:nowrap" class="ft00"><b>Forward&#160;compatibility&#160;for&#160;new&#160;systems</b></p>
<p style="position:absolute;top:974px;left:59px;white-space:nowrap" class="ft05">The&#160;method&#160;applies&#160;best&#160;where&#160;the&#160;chrooted&#160;systems&#160;are&#160;older&#160;(or&#160;the&#160;same)&#160;operating&#160;systems&#160;compared&#160;with&#160;the&#160;native&#160;system.&#160;But&#160;if&#160;you&#160;chroot&#160;from<br/>the&#160;native&#160;system&#160;to&#160;a&#160;newer&#160;system&#160;(one&#160;that&#160;normally&#160;uses&#160;a&#160;more&#160;recent&#160;kernel),&#160;this&#160;may&#160;be&#160;rejected&#160;with&#160;the&#160;following&#160;message,&#160;arising&#160;from<br/>/lib[64]/ld*so:&#160;<b>FATAL:&#160;kernel&#160;too&#160;old</b>.&#160;For&#160;example,&#160;an&#160;original&#160;Fedora&#160;12&#160;kernel&#160;2.6.31&#160;can't&#160;chroot&#160;to&#160;a&#160;Fedora&#160;14&#160;system&#160;which&#160;normally&#160;uses&#160;kernel<br/>2.6.35,&#160;because&#160;of&#160;that&#160;rejection.&#160;However,&#160;an&#160;end-of-life-cycle&#160;Fedora&#160;12&#160;kernel&#160;2.6.32&#160;didn't&#160;have&#160;that&#160;problem,&#160;and&#160;so&#160;for&#160;example&#160;I&#160;was&#160;able&#160;to&#160;use&#160;a<br/>Fedora&#160;14&#160;image&#160;on&#160;a&#160;Fedora&#160;12&#160;native&#160;system,&#160;before&#160;I&#160;moved&#160;to&#160;Fedora&#160;14&#160;as&#160;my&#160;native&#160;system.</p>
<p style="position:absolute;top:1047px;left:59px;white-space:nowrap" class="ft00"><b>Other&#160;methods&#160;and&#160;implementations</b></p>
<p style="position:absolute;top:1077px;left:59px;white-space:nowrap" class="ft05">As&#160;it&#160;turns&#160;out,&#160;after&#160;the&#160;event,&#160;we&#160;and&#160;ClusterVision&#160;are&#160;not&#160;alone&#160;in&#160;using&#160;these&#160;techniques!&#160;(Not&#160;surprising,&#160;as&#160;the&#160;basic&#160;chroot&#160;facility&#160;has&#160;been&#160;built&#160;into<br/>Unix/Linux&#160;since&#160;the&#160;early&#160;days.&#160;However,&#160;it's&#160;the&#160;much&#160;more&#160;recent&#160;introduction&#160;of&#160;bind&#160;mounting&#160;in&#160;kernel&#160;2.4&#160;that&#160;has&#160;transformed&#160;the&#160;possibilities&#160;in<br/>this&#160;area).&#160;Some&#160;of&#160;these&#160;other&#160;methods&#160;are&#160;quite&#160;elaborate,&#160;with&#160;special&#160;kernels,&#160;and&#160;can&#160;provide&#160;a&#160;degree&#160;of&#160;isolation&#160;between&#160;the&#160;different&#160;virtual<br/>systems&#160;that&#160;we&#160;ourselves&#160;are&#160;not&#160;seeking.&#160;Here&#160;are&#160;some&#160;references:</p>
<p style="position:absolute;top:1135px;left:84px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:1135px;left:87px;white-space:nowrap" class="ft04">Linux&#160;Virtualization&#160;Wiki</p>
<p style="position:absolute;top:1135px;left:214px;white-space:nowrap" class="ft01">&#160;and&#160;</p>
<p style="position:absolute;top:1135px;left:240px;white-space:nowrap" class="ft04">Technical&#160;Overview</p>
<p style="position:absolute;top:1135px;left:340px;white-space:nowrap" class="ft01">&#160;and&#160;</p>
<p style="position:absolute;top:1135px;left:366px;white-space:nowrap" class="ft04">Technical&#160;comparison</p>
<p style="position:absolute;top:1135px;left:477px;white-space:nowrap" class="ft01">&#160;(see&#160;Containers&#160;column)</p>
<p style="position:absolute;top:1147px;left:84px;white-space:nowrap" class="ft09">OpenVZ<br/>Pushing&#160;Torque&#160;jobs&#160;in&#160;a&#160;chroot&#160;environment<br/>CHOS&#160;-&#160;chroot&#160;OS</p>
</div>
</body>
</html>
