<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 94</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:8px;font-family:DejaVuSans;color:#000000;}
	.ft01{font-size:6px;font-family:DejaVuSans;color:#000000;}
	.ft02{font-size:8px;font-family:DejaVuSansMono;color:#000000;}
	.ft03{font-size:8px;line-height:10px;font-family:DejaVuSans;color:#000000;}
	.ft04{font-size:8px;line-height:10px;font-family:DejaVuSansMono;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page94-div" style="position:relative;width:892px;height:1263px;">
<img width="892" height="1263" src="ALL-07052021094.png" alt="background image"/>
<p style="position:absolute;top:55px;left:177px;white-space:nowrap" class="ft00">cd&#160;~</p>
<p style="position:absolute;top:76px;left:177px;white-space:nowrap" class="ft00">Now&#160;adjust&#160;any&#160;environment&#160;variables&#160;as&#160;necessary.</p>
<p style="position:absolute;top:97px;left:177px;white-space:nowrap" class="ft03">In&#160;the&#160;guest&#160;terminal,&#160;type&#160;&#34;xhost&#160;+&#34;&#160;to&#160;allow&#160;X&#160;applications&#160;to&#160;display.&#160;To&#160;test&#160;this,&#160;try&#160;running&#160;a&#160;simple&#160;X&#160;program&#160;like&#160;xclock&#160;and&#160;see&#160;if<br/>the&#160;window&#160;shows&#160;up&#160;on&#160;your&#160;host&#160;desktop.</p>
<p style="position:absolute;top:129px;left:177px;white-space:nowrap" class="ft03">That&#160;is&#160;basic&#160;chroot&#160;+&#160;X.&#160;But&#160;desktop&#160;environments&#160;require&#160;a&#160;bit&#160;more&#160;handling.&#160;Option&#160;1&#160;above&#160;requires&#160;starting&#160;a&#160;second&#160;X&#160;server&#160;on&#160;the<br/>host.&#160;The&#160;way&#160;to&#160;do&#160;this&#160;is&#160;a&#160;bit&#160;obscure;&#160;just&#160;typing&#160;startx&#160;won't&#160;work.&#160;For&#160;this&#160;we&#160;need&#160;a&#160;separate&#160;tty&#160;outside&#160;the&#160;running&#160;X.&#160;Press<br/>CTRL+ALT+F2&#160;to&#160;switch&#160;to&#160;tty2&#160;if&#160;it&#160;is&#160;unused.&#160;Before&#160;continuing,&#160;temporarily&#160;rename&#160;any&#160;.xinitrc&#160;files&#160;-&#160;we&#160;are&#160;only&#160;testing&#160;here.&#160;In&#160;fact,<br/>DO&#160;NOT&#160;use&#160;the&#160;xinitrc&#160;files&#160;as&#160;specified&#160;in&#160;the&#160;BLFS&#160;book;&#160;these&#160;probably&#160;involve&#160;consolekit,&#160;dbus,&#160;and&#160;the&#160;like&#160;which&#160;are&#160;already&#160;running<br/>if&#160;you&#160;have&#160;a&#160;desktop&#160;environment&#160;up&#160;and&#160;running&#160;already.&#160;So,&#160;with&#160;no&#160;xinitrc&#160;files,&#160;let's&#160;continue.</p>
<p style="position:absolute;top:194px;left:177px;white-space:nowrap" class="ft00">A&#160;popular&#160;way&#160;to&#160;start&#160;a&#160;second&#160;X&#160;server&#160;is&#160;to&#160;run</p>
<p style="position:absolute;top:218px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:231px;left:192px;white-space:nowrap" class="ft02">startx&#160;--&#160;:1</p>
<p style="position:absolute;top:267px;left:177px;white-space:nowrap" class="ft03">This&#160;gives&#160;the&#160;server&#160;the&#160;name&#160;&#34;:1&#34;&#160;(the&#160;existing&#160;one&#160;is&#160;probably&#160;&#34;:0.0&#34;&#160;and&#160;can&#160;be&#160;found&#160;by&#160;noting&#160;the&#160;value&#160;of&#160;the&#160;DISPLAY&#160;environment<br/>variable,&#160;i.e.</p>
<p style="position:absolute;top:302px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:315px;left:192px;white-space:nowrap" class="ft02">echo&#160;$DISPLAY</p>
<p style="position:absolute;top:351px;left:177px;white-space:nowrap" class="ft00">We&#160;can&#160;specify&#160;which&#160;tty&#160;the&#160;second&#160;server&#160;will&#160;be&#160;on&#160;(if&#160;the&#160;existing&#160;one&#160;is&#160;tty7,&#160;we&#160;might&#160;want&#160;the&#160;second&#160;one&#160;on&#160;tty8)&#160;by&#160;doing&#160;this:</p>
<p style="position:absolute;top:376px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:389px;left:192px;white-space:nowrap" class="ft02">startx&#160;--&#160;:1&#160;vt8</p>
<p style="position:absolute;top:425px;left:177px;white-space:nowrap" class="ft03">If&#160;this&#160;is&#160;successful,&#160;pressing&#160;CTRL+ALT+F8&#160;should&#160;take&#160;us&#160;to&#160;the&#160;second&#160;X&#160;server,&#160;which,&#160;as&#160;it&#160;is&#160;in&#160;its&#160;unconfigured&#160;state&#160;should&#160;show&#160;the<br/>traditional&#160;three&#160;xterm&#160;windows.&#160;If&#160;we&#160;go&#160;back&#160;to&#160;tty7&#160;and&#160;go&#160;to&#160;the&#160;chroot&#160;terminal,&#160;and&#160;type&#160;something&#160;like</p>
<p style="position:absolute;top:460px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:473px;left:192px;white-space:nowrap" class="ft02">DISPLAY=&#34;:1&#34;&#160;xclock</p>
<p style="position:absolute;top:509px;left:177px;white-space:nowrap" class="ft03">The&#160;xclock&#160;program&#160;should&#160;show&#160;up&#160;on&#160;tty8.&#160;The&#160;problem&#160;here&#160;is&#160;that&#160;we&#160;would&#160;like&#160;to&#160;run&#160;a&#160;desktop&#160;on&#160;tty8&#160;but&#160;startx&#160;gives&#160;us&#160;the&#160;usual<br/>twm&#160;manager&#160;and&#160;the&#160;like.&#160;We&#160;need&#160;a&#160;&#34;naked&#34;&#160;X&#160;server,&#160;so&#160;instead&#160;of&#160;using&#160;startx,&#160;we&#160;should&#160;do</p>
<p style="position:absolute;top:544px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:557px;left:192px;white-space:nowrap" class="ft02">/usr/bin/X&#160;:1&#160;vt8</p>
<p style="position:absolute;top:594px;left:177px;white-space:nowrap" class="ft03">instead.&#160;Note:&#160;You&#160;need&#160;to&#160;remove&#160;the&#160;guest's&#160;.Xauthority&#160;file&#160;and&#160;replace&#160;it&#160;with&#160;the&#160;host's&#160;(again)&#160;if&#160;you&#160;copied&#160;this&#160;file&#160;before&#160;starting<br/>the&#160;second&#160;server!</p>
<p style="position:absolute;top:626px;left:177px;white-space:nowrap" class="ft00">Now&#160;we&#160;could&#160;go&#160;to&#160;the&#160;chroot&#160;terminal&#160;and&#160;launch&#160;our&#160;desktop&#160;environment,&#160;making&#160;sure&#160;to&#160;prepend&#160;the&#160;command&#160;like&#160;so:</p>
<p style="position:absolute;top:650px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:663px;left:192px;white-space:nowrap" class="ft02">DISPLAY=&#34;:1&#34;&#160;mate-session</p>
<p style="position:absolute;top:699px;left:177px;white-space:nowrap" class="ft00">I&#160;got&#160;MATE&#160;desktop&#160;to&#160;start&#160;properly&#160;this&#160;way;&#160;Plasma&#160;5&#160;locked&#160;up&#160;my&#160;display&#160;completely.&#160;Not&#160;all&#160;desktop&#160;environments&#160;will&#160;work&#160;this&#160;way.</p>
<p style="position:absolute;top:721px;left:177px;white-space:nowrap" class="ft00">Option&#160;2&#160;(xnest)&#160;will&#160;work&#160;similarly.&#160;On&#160;the&#160;host,&#160;type</p>
<p style="position:absolute;top:745px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:758px;left:192px;white-space:nowrap" class="ft02">Xnest&#160;-ac&#160;:1</p>
<p style="position:absolute;top:794px;left:177px;white-space:nowrap" class="ft03">which&#160;will&#160;show&#160;a&#160;blank&#160;nested&#160;X&#160;window.&#160;Now&#160;you&#160;can&#160;launch&#160;your&#160;desktop&#160;environment&#160;as&#160;above&#160;with&#160;the&#160;proper&#160;DISPLAY,&#160;and&#160;hopefully<br/>it&#160;will&#160;launch&#160;properly.&#160;Xnest&#160;does&#160;not&#160;support&#160;a&#160;lot&#160;of&#160;X&#160;extensions&#160;so&#160;Plasma&#160;5&#160;will&#160;NOT&#160;work&#160;here.&#160;Also,&#160;Xnest&#160;does&#160;not&#160;repaint&#160;the<br/>window&#160;when&#160;it&#160;should,&#160;so&#160;use&#160;at&#160;your&#160;own&#160;risk.</p>
<p style="position:absolute;top:837px;left:177px;white-space:nowrap" class="ft03">Option&#160;3&#160;(Xephyr)&#160;is&#160;probably&#160;the&#160;easiest.&#160;It&#160;is&#160;part&#160;of&#160;the&#160;xorg-server&#160;package&#160;and&#160;as&#160;of&#160;version&#160;1.18&#160;does&#160;not&#160;build&#160;even&#160;if&#160;the<br/>prerequisites&#160;are&#160;present.&#160;So,&#160;rebuild&#160;the&#160;package&#160;adding&#160;--enable-kdrive&#160;--enable-xephyr&#160;to&#160;the&#160;configure&#160;line.&#160;Note:&#160;Rebuild&#160;xorg-xserver<br/>for&#160;the&#160;GUEST,&#160;not&#160;the&#160;host.&#160;Using&#160;any&#160;other&#160;Xephyr&#160;executable&#160;other&#160;than&#160;one&#160;built&#160;for&#160;the&#160;guest&#160;OS&#160;is&#160;likely&#160;to&#160;cause&#160;problems.&#160;Use&#160;the<br/>prefix&#160;and&#160;other&#160;arguments&#160;as&#160;specified&#160;when&#160;you&#160;built&#160;xorg-server.&#160;If&#160;you&#160;don't&#160;want&#160;to&#160;replace&#160;your&#160;existing&#160;executables,&#160;don't&#160;run<br/>&#34;make&#160;install&#34;&#160;-&#160;just&#160;find&#160;the&#160;compiled&#160;Xephyr&#160;and&#160;use&#160;it.&#160;It&#160;has&#160;no&#160;dependent&#160;shared&#160;objects&#160;that&#160;aren't&#160;already&#160;present.</p>
<p style="position:absolute;top:901px;left:177px;white-space:nowrap" class="ft00">In&#160;the&#160;guest&#160;(!),&#160;run</p>
<p style="position:absolute;top:925px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:938px;left:192px;white-space:nowrap" class="ft02">Xephyr&#160;-br&#160;-ac&#160;-noreset&#160;-screen&#160;1280x720&#160;:1&#160;&amp;</p>
<p style="position:absolute;top:975px;left:177px;white-space:nowrap" class="ft00">But&#160;don't&#160;make&#160;the&#160;size&#160;any&#160;bigger&#160;than&#160;you&#160;can&#160;handle.&#160;Don't&#160;forget&#160;the&#160;&#34;&amp;&#34;&#160;-&#160;now&#160;start&#160;your&#160;desktop&#160;environment.&#160;For&#160;example</p>
<p style="position:absolute;top:999px;left:189px;white-space:nowrap" class="ft01">Code:</p>
<p style="position:absolute;top:1012px;left:192px;white-space:nowrap" class="ft04">#&#160;Instead&#160;of&#160;using&#160;i.e.&#160;DISPLAY=&#34;:1&#34;&#160;command<br/>#&#160;we&#160;should&#160;probably&#160;use&#160;export&#160;DISPLAY=&#34;:1&#34;<br/>#&#160;for&#160;complicated&#160;scripts&#160;like&#160;that&#160;used&#160;by<br/>#&#160;KDE</p>
<p style="position:absolute;top:1065px;left:192px;white-space:nowrap" class="ft04">export&#160;DISPLAY=&#34;:1&#34;<br/>startkde</p>
<p style="position:absolute;top:1109px;left:177px;white-space:nowrap" class="ft03">I&#160;got&#160;Plasma&#160;5&#160;to&#160;run&#160;this&#160;way&#160;as&#160;well&#160;as&#160;Mate.&#160;Note&#160;that&#160;Xephyr&#160;does&#160;not&#160;(as&#160;of&#160;xorg-server&#160;1.18)&#160;get&#160;the&#160;font&#160;DPI&#160;right,&#160;so&#160;you&#160;will&#160;need&#160;to<br/>edit&#160;the&#160;appropriate&#160;setting&#160;in&#160;your&#160;desktop&#160;environment&#160;(mine&#160;should&#160;be&#160;96&#160;dpi,&#160;yours&#160;may&#160;be&#160;different).</p>
<p style="position:absolute;top:1141px;left:177px;white-space:nowrap" class="ft03">Because&#160;we&#160;bind-mounted&#160;/run,&#160;/run/dbus&#160;is&#160;present&#160;and&#160;accessible&#160;to&#160;the&#160;guest.&#160;Also,&#160;note&#160;that&#160;we&#160;mounted&#160;/proc&#160;using&#160;&#34;mount&#160;-t&#160;proc<br/>/proc&#160;...&#34;&#160;rather&#160;than&#160;&#34;mount&#160;-t&#160;proc&#160;none&#160;...&#34;&#160;which&#160;lists&#160;host&#160;processes&#160;in&#160;the&#160;guest;&#160;programs&#160;like&#160;mate-system-monitor&#160;or&#160;ksysguard&#160;in<br/>the&#160;guest&#160;will&#160;show&#160;(and&#160;kill,&#160;if&#160;told&#160;to)&#160;programs&#160;in&#160;the&#160;host,&#160;so&#160;use&#160;with&#160;care.</p>
</div>
</body>
</html>
