<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 88</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:11px;font-family:DejaVuSerif;color:#000000;}
	.ft01{font-size:11px;font-family:DejaVuSansMono;color:#000000;}
	.ft02{font-size:11px;font-family:DejaVuSerif;color:#0b61a4;}
	.ft03{font-size:13px;font-family:DejaVuSerif;color:#000000;}
	.ft04{font-size:11px;line-height:13px;font-family:DejaVuSansMono;color:#000000;}
	.ft05{font-size:11px;line-height:13px;font-family:DejaVuSerif;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page88-div" style="position:relative;width:892px;height:1263px;">
<img width="892" height="1263" src="ALL-07052021088.png" alt="background image"/>
<p style="position:absolute;top:54px;left:82px;white-space:nowrap" class="ft00">The&#160;first&#160;is&#160;</p>
<p style="position:absolute;top:54px;left:151px;white-space:nowrap" class="ft01">config</p>
<p style="position:absolute;top:54px;left:192px;white-space:nowrap" class="ft00">,&#160;and&#160;it&#160;is&#160;simply&#160;a&#160;shell&#160;script&#160;fragment&#160;describing&#160;the&#160;location&#160;of</p>
<p style="position:absolute;top:68px;left:82px;white-space:nowrap" class="ft00">the&#160;other&#160;files.&#160;Mine&#160;looks&#160;like&#160;this:</p>
<p style="position:absolute;top:100px;left:100px;white-space:nowrap" class="ft04">#&#160;Filesystems&#160;to&#160;mount&#160;inside&#160;the&#160;chroot.<br/>FSTAB=&#34;/etc/schroot/unsafe/fstab&#34;</p>
<p style="position:absolute;top:142px;left:100px;white-space:nowrap" class="ft04">#&#160;Files&#160;to&#160;copy&#160;from&#160;the&#160;host&#160;system&#160;into&#160;the&#160;chroot.<br/>COPYFILES=&#34;/etc/schroot/unsafe/copyfiles&#34;</p>
<p style="position:absolute;top:183px;left:100px;white-space:nowrap" class="ft04">#&#160;System&#160;NSS&#160;databases&#160;to&#160;copy&#160;into&#160;the&#160;chroot.<br/>NSSDATABASES=&#34;/etc/schroot/unsafe/nssdatabases&#34;</p>
<p style="position:absolute;top:229px;left:82px;white-space:nowrap" class="ft00">The&#160;&#160;second&#160;&#160;is&#160;&#160;a&#160;&#160;description&#160;&#160;of&#160;&#160;the&#160;&#160;filesystems&#160;&#160;to&#160;&#160;be&#160;&#160;mounted&#160;&#160;onto&#160;&#160;the&#160;&#160;chroot,&#160;&#160;in</p>
<p style="position:absolute;top:243px;left:82px;white-space:nowrap" class="ft01">fstab(5)</p>
<p style="position:absolute;top:243px;left:136px;white-space:nowrap" class="ft00">&#160;syntax.&#160;In&#160;this&#160;case,&#160;the&#160;entries&#160;are&#160;all&#160;bind&#160;mounts,&#160;and&#160;there&#160;are&#160;two&#160;extra</p>
<p style="position:absolute;top:257px;left:82px;white-space:nowrap" class="ft00">mounts&#160;&#160;that&#160;&#160;won't&#160;&#160;appear&#160;&#160;in&#160;&#160;most&#160;&#160;chroots:&#160;</p>
<p style="position:absolute;top:257px;left:350px;white-space:nowrap" class="ft01">/home/elb/.pulse</p>
<p style="position:absolute;top:257px;left:458px;white-space:nowrap" class="ft00">&#160;&#160;and&#160;</p>
<p style="position:absolute;top:257px;left:493px;white-space:nowrap" class="ft01">/var/lib/dbus</p>
<p style="position:absolute;top:257px;left:581px;white-space:nowrap" class="ft00">.</p>
<p style="position:absolute;top:271px;left:82px;white-space:nowrap" class="ft05">These&#160;directories&#160;are&#160;required&#160;to&#160;get&#160;PulseAudio&#160;connectivity&#160;into&#160;the&#160;chroot,&#160;and&#160;they<br/>are&#160;helpfully&#160;documented&#160;in&#160;the&#160;</p>
<p style="position:absolute;top:284px;left:269px;white-space:nowrap" class="ft02">PulseAudio&#160;FAQ</p>
<p style="position:absolute;top:284px;left:362px;white-space:nowrap" class="ft00">.&#160;The&#160;complete&#160;fstab&#160;for&#160;my&#160;setup&#160;is:</p>
<p style="position:absolute;top:316px;left:100px;white-space:nowrap" class="ft01">/proc&#160;</p>
<p style="position:absolute;top:316px;left:154px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:316px;left:209px;white-space:nowrap" class="ft01">/proc&#160;</p>
<p style="position:absolute;top:316px;left:263px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:316px;left:318px;white-space:nowrap" class="ft01">none&#160;</p>
<p style="position:absolute;top:316px;left:372px;white-space:nowrap" class="ft01">rw,bind&#160;&#160;</p>
<p style="position:absolute;top:316px;left:481px;white-space:nowrap" class="ft01">0&#160;</p>
<p style="position:absolute;top:316px;left:536px;white-space:nowrap" class="ft01">0</p>
<p style="position:absolute;top:330px;left:100px;white-space:nowrap" class="ft01">/sys&#160;</p>
<p style="position:absolute;top:330px;left:154px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:330px;left:209px;white-space:nowrap" class="ft01">/sys&#160;</p>
<p style="position:absolute;top:330px;left:263px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:330px;left:318px;white-space:nowrap" class="ft01">none&#160;</p>
<p style="position:absolute;top:330px;left:372px;white-space:nowrap" class="ft01">rw,bind&#160;&#160;</p>
<p style="position:absolute;top:330px;left:481px;white-space:nowrap" class="ft01">0&#160;</p>
<p style="position:absolute;top:330px;left:536px;white-space:nowrap" class="ft01">0</p>
<p style="position:absolute;top:344px;left:100px;white-space:nowrap" class="ft01">/tmp&#160;</p>
<p style="position:absolute;top:344px;left:154px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:344px;left:209px;white-space:nowrap" class="ft01">/tmp&#160;</p>
<p style="position:absolute;top:344px;left:263px;white-space:nowrap" class="ft01">&#160;</p>
<p style="position:absolute;top:344px;left:318px;white-space:nowrap" class="ft01">none&#160;</p>
<p style="position:absolute;top:344px;left:372px;white-space:nowrap" class="ft01">rw,bind&#160;&#160;</p>
<p style="position:absolute;top:344px;left:481px;white-space:nowrap" class="ft01">0&#160;</p>
<p style="position:absolute;top:344px;left:536px;white-space:nowrap" class="ft01">0</p>
<p style="position:absolute;top:358px;left:100px;white-space:nowrap" class="ft01">/run/shm&#160;</p>
<p style="position:absolute;top:358px;left:209px;white-space:nowrap" class="ft01">/run/shm&#160;</p>
<p style="position:absolute;top:358px;left:318px;white-space:nowrap" class="ft01">none&#160;</p>
<p style="position:absolute;top:358px;left:372px;white-space:nowrap" class="ft01">rw,bind&#160;&#160;</p>
<p style="position:absolute;top:358px;left:481px;white-space:nowrap" class="ft01">0&#160;</p>
<p style="position:absolute;top:358px;left:536px;white-space:nowrap" class="ft01">0</p>
<p style="position:absolute;top:372px;left:100px;white-space:nowrap" class="ft01">/home/elb/.pulse&#160;</p>
<p style="position:absolute;top:372px;left:263px;white-space:nowrap" class="ft01">/home/elb/.pulse&#160;</p>
<p style="position:absolute;top:372px;left:427px;white-space:nowrap" class="ft01">none&#160;</p>
<p style="position:absolute;top:372px;left:481px;white-space:nowrap" class="ft01">rw,bind&#160;0&#160;</p>
<p style="position:absolute;top:372px;left:590px;white-space:nowrap" class="ft01">0</p>
<p style="position:absolute;top:386px;left:100px;white-space:nowrap" class="ft01">/var/lib/dbus&#160;</p>
<p style="position:absolute;top:386px;left:209px;white-space:nowrap" class="ft01">/var/lib/dbus&#160;</p>
<p style="position:absolute;top:386px;left:318px;white-space:nowrap" class="ft01">none&#160;</p>
<p style="position:absolute;top:386px;left:372px;white-space:nowrap" class="ft01">rw,bind&#160;&#160;</p>
<p style="position:absolute;top:386px;left:481px;white-space:nowrap" class="ft01">0&#160;</p>
<p style="position:absolute;top:386px;left:536px;white-space:nowrap" class="ft01">0</p>
<p style="position:absolute;top:418px;left:82px;white-space:nowrap" class="ft05">Having&#160;established&#160;the&#160;configuration&#160;to&#160;be&#160;used&#160;for&#160;the&#160;chroot,&#160;we&#160;now&#160;have&#160;to&#160;bind&#160;it<br/>to&#160;&#160;the&#160;&#160;chroot&#160;&#160;directory&#160;&#160;and&#160;&#160;determine&#160;&#160;who&#160;&#160;can&#160;&#160;use&#160;&#160;it.&#160;&#160;This&#160;&#160;is&#160;&#160;done&#160;&#160;in&#160;&#160;the&#160;&#160;file</p>
<p style="position:absolute;top:445px;left:82px;white-space:nowrap" class="ft01">/etc/schroot/schroot.conf</p>
<p style="position:absolute;top:445px;left:252px;white-space:nowrap" class="ft00">,&#160;which&#160;uses&#160;a&#160;syntax&#160;reminiscent&#160;of&#160;Windows&#160;</p>
<p style="position:absolute;top:445px;left:526px;white-space:nowrap" class="ft01">.ini</p>
<p style="position:absolute;top:445px;left:553px;white-space:nowrap" class="ft00">&#160;files.</p>
<p style="position:absolute;top:459px;left:82px;white-space:nowrap" class="ft00">To&#160;configure&#160;this&#160;particular&#160;chroot,&#160;I&#160;used&#160;this&#160;stanza:</p>
<p style="position:absolute;top:491px;left:100px;white-space:nowrap" class="ft04">[unsafe-i386]<br/>type=directory<br/>directory=/mnt/unsafe<br/>description=Precise&#160;chroot&#160;for&#160;i386&#160;untrusted&#160;binaries<br/>script-config=unsafe/config<br/>personality=linux32<br/>users=elb</p>
<p style="position:absolute;top:606px;left:82px;white-space:nowrap" class="ft00">This&#160;&#160;instructs&#160;</p>
<p style="position:absolute;top:606px;left:166px;white-space:nowrap" class="ft01">schroot</p>
<p style="position:absolute;top:606px;left:214px;white-space:nowrap" class="ft00">&#160;&#160;to&#160;&#160;create&#160;&#160;a&#160;&#160;jail&#160;&#160;called&#160;</p>
<p style="position:absolute;top:606px;left:350px;white-space:nowrap" class="ft00">unsafe-i386&#160;using&#160;the&#160;unsafe&#160;scripts&#160;we</p>
<p style="position:absolute;top:620px;left:82px;white-space:nowrap" class="ft00">created&#160;earlier&#160;on&#160;a&#160;jail&#160;located&#160;at&#160;</p>
<p style="position:absolute;top:620px;left:283px;white-space:nowrap" class="ft01">/mnt/unsafe</p>
<p style="position:absolute;top:620px;left:358px;white-space:nowrap" class="ft00">&#160;containing&#160;an&#160;i386&#160;distribution,&#160;and&#160;to</p>
<p style="position:absolute;top:634px;left:82px;white-space:nowrap" class="ft00">allow&#160;the&#160;user&#160;elb&#160;to&#160;create&#160;and&#160;enter&#160;the&#160;jail&#160;without&#160;superuser&#160;privileges.</p>
<p style="position:absolute;top:659px;left:82px;white-space:nowrap" class="ft00">The&#160;last&#160;step&#160;is&#160;to&#160;create&#160;a&#160;home&#160;directory&#160;on&#160;the&#160;chroot,&#160;and&#160;add&#160;a&#160;user&#160;account&#160;to&#160;its</p>
<p style="position:absolute;top:673px;left:82px;white-space:nowrap" class="ft01">/etc/passwd</p>
<p style="position:absolute;top:673px;left:157px;white-space:nowrap" class="ft00">&#160;&#160;and&#160;</p>
<p style="position:absolute;top:673px;left:191px;white-space:nowrap" class="ft01">/etc/group</p>
<p style="position:absolute;top:673px;left:259px;white-space:nowrap" class="ft00">&#160;&#160;databases.&#160;&#160;You&#160;&#160;can&#160;&#160;probably&#160;&#160;accomplish&#160;&#160;this&#160;&#160;by&#160;&#160;the</p>
<p style="position:absolute;top:687px;left:82px;white-space:nowrap" class="ft05">following&#160;&#160;(basically&#160;&#160;what&#160;&#160;I&#160;&#160;did),&#160;&#160;but&#160;&#160;you&#160;&#160;will&#160;&#160;want&#160;&#160;to&#160;&#160;double-check&#160;&#160;the&#160;&#160;results;&#160;&#160;in<br/>particular,&#160;assuming&#160;that&#160;the&#160;current&#160;user's&#160;primary&#160;GID&#160;is&#160;the&#160;same&#160;as&#160;the&#160;UID&#160;is&#160;not<br/>so&#160;portable&#160;(but&#160;will&#160;work&#160;on&#160;most&#160;standalone&#160;Ubuntu&#160;installs):</p>
<p style="position:absolute;top:747px;left:100px;white-space:nowrap" class="ft04">sudo&#160;mkdir&#160;-p&#160;/mnt/unsafe/home/$USER<br/>sudo&#160;chown&#160;$USER:$USER&#160;/mnt/unsafe/home/$USER<br/>sudo&#160;echo&#160;&#34;$USER:x:$UID:$UID:,,,:/home/$USER:/bin/bash&#34;&#160;&gt;&gt;&#160;/mnt/unsafe/etc/passwd<br/>sudo&#160;echo&#160;&#34;$USER:x:$UID:&#34;&#160;&gt;&gt;&#160;/mnt/unsafe/etc/group</p>
<p style="position:absolute;top:822px;left:82px;white-space:nowrap" class="ft03"><b>Buffering&#160;X11&#160;access</b></p>
<p style="position:absolute;top:851px;left:82px;white-space:nowrap" class="ft05">An&#160;application&#160;with&#160;direct&#160;access&#160;to&#160;your&#160;X11&#160;server&#160;can&#160;do&#160;all&#160;kinds&#160;of&#160;mean,&#160;nasty,<br/>ugly&#160;things&#160;to&#160;you,&#160;particularly&#160;if&#160;it&#160;belongs&#160;on&#160;the&#160;Group&#160;W&#160;bench&#160;like&#160;Skype.&#160;These<br/>things&#160;range&#160;from&#160;sniffing&#160;your&#160;keystrokes&#160;to&#160;bypassing&#160;your&#160;screen&#160;lock&#160;to&#160;who&#160;knows<br/>what&#160;else.&#160;Unfortunately,&#160;we&#160;have&#160;to&#160;provide&#160;the&#160;jail&#160;with&#160;access&#160;to&#160;several&#160;things&#160;we<br/>would&#160;rather&#160;not&#160;(like&#160;</p>
<p style="position:absolute;top:906px;left:213px;white-space:nowrap" class="ft01">/tmp</p>
<p style="position:absolute;top:906px;left:240px;white-space:nowrap" class="ft00">,&#160;the&#160;PulseAudio&#160;socket,&#160;and&#160;—&#160;possibly&#160;most&#160;unfortunately</p>
<p style="position:absolute;top:920px;left:82px;white-space:nowrap" class="ft00">—&#160;dbus),&#160;but&#160;that&#160;doesn't&#160;mean&#160;we&#160;have&#160;to&#160;give&#160;it&#160;direct&#160;access&#160;to&#160;X11.</p>
<p style="position:absolute;top:945px;left:82px;white-space:nowrap" class="ft00">Enter&#160;</p>
<p style="position:absolute;top:945px;left:122px;white-space:nowrap" class="ft02">Xpra</p>
<p style="position:absolute;top:945px;left:149px;white-space:nowrap" class="ft00">.&#160;&#160;Xpra&#160;&#160;is&#160;&#160;what&#160;&#160;the&#160;&#160;maintainers&#160;&#160;describe&#160;&#160;as&#160;&#160;“screen&#160;&#160;for&#160;&#160;X,“&#160;&#160;providing</p>
<p style="position:absolute;top:959px;left:82px;white-space:nowrap" class="ft05">detachable&#160;sessions&#160;and&#160;window&#160;forwarding&#160;over&#160;the&#160;network&#160;via&#160;an&#160;efficient,&#160;rootless<br/>protocol.&#160;In&#160;this&#160;case,&#160;however,&#160;we're&#160;not&#160;as&#160;concerned&#160;about&#160;that&#160;as&#160;the&#160;fact&#160;that&#160;Xpra<br/>uses&#160;its&#160;own&#160;headless&#160;X&#160;server&#160;and&#160;proxies&#160;actual&#160;windowing&#160;information&#160;between&#160;the<br/>client&#160;&#160;and&#160;&#160;your&#160;&#160;server.&#160;&#160;The&#160;&#160;actual&#160;&#160;extent&#160;&#160;to&#160;&#160;which&#160;&#160;this&#160;&#160;will&#160;&#160;protect&#160;&#160;you&#160;&#160;from&#160;&#160;client<br/>badness&#160;isn't&#160;clear&#160;to&#160;me,&#160;but&#160;it's&#160;a&#160;start.&#160;I&#160;need&#160;to&#160;do&#160;more&#160;research&#160;on&#160;this&#160;point&#160;—&#160;as<br/>well&#160;&#160;as&#160;&#160;into&#160;&#160;the&#160;&#160;possibility&#160;&#160;of&#160;&#160;using&#160;&#160;a&#160;&#160;newer&#160;&#160;release&#160;&#160;of&#160;&#160;Xpra&#160;&#160;to&#160;&#160;handle&#160;&#160;this&#160;&#160;whole<br/>shebang&#160;from&#160;a&#160;VM&#160;using&#160;PulseAudio.</p>
<p style="position:absolute;top:1067px;left:82px;white-space:nowrap" class="ft05">To&#160;get&#160;the&#160;Ubuntu&#160;packages&#160;for&#160;Xpra,&#160;we&#160;have&#160;to&#160;add&#160;Universe&#160;to&#160;the&#160;chroot&#160;package<br/>system.&#160;&#160;In&#160;&#160;order&#160;&#160;to&#160;&#160;do&#160;&#160;that,&#160;&#160;edit&#160;&#160;(as&#160;&#160;root)&#160;</p>
<p style="position:absolute;top:1081px;left:340px;white-space:nowrap" class="ft01">/mnt/unsafe/etc/apt/sources.list</p>
<p style="position:absolute;top:1081px;left:558px;white-space:nowrap" class="ft00">&#160;&#160;and</p>
<p style="position:absolute;top:1095px;left:82px;white-space:nowrap" class="ft00">add&#160;the&#160;word&#160;</p>
<p style="position:absolute;top:1095px;left:161px;white-space:nowrap" class="ft01">universe</p>
<p style="position:absolute;top:1095px;left:216px;white-space:nowrap" class="ft00">&#160;to&#160;the&#160;end&#160;of&#160;the&#160;Precise&#160;sources&#160;line.&#160;It&#160;should&#160;look&#160;like&#160;this:</p>
<p style="position:absolute;top:1127px;left:100px;white-space:nowrap" class="ft01">deb&#160;http://archive.ubuntu.com/ubuntu&#160;precise&#160;main&#160;universe</p>
<p style="position:absolute;top:1159px;left:82px;white-space:nowrap" class="ft05">Having&#160;&#160;done&#160;&#160;that,&#160;&#160;enter&#160;&#160;the&#160;&#160;chroot&#160;&#160;jail&#160;&#160;as&#160;&#160;root&#160;&#160;and&#160;&#160;install&#160;&#160;the&#160;&#160;package&#160;&#160;and&#160;&#160;its<br/>prerequisites:</p>
</div>
</body>
</html>
